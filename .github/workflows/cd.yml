name: Continuous Delivery (CD)

on:
  workflow_run:
    workflows: ["Continuous Integration (CI)"] # 💡 ci.yml の name と完全に一致させる
    types: [completed]
    branches: [main]

jobs:
  # 💡 workflow_run を使う場合、needs: ci は不要です
  deploy:
    runs-on: ubuntu-latest
    
    # workflow_run を使ってトリガーされた場合、成功をチェックするステップを追加
    if: ${{ github.event.workflow_run.conclusion == 'success' }}

    env:
      CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
      CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}

    steps:
      - name: ⬇️ Checkout Repository
        # workflow_run の場合は、リポジトリの履歴を再度チェックアウトする必要があります
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.workflow_run.head_sha }} # CIが実行されたコミットをチェックアウト

      - name: ⚙️ Setup Node.js
        # ... 後略 ...